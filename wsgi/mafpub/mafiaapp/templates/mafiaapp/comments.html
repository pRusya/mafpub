{% load staticfiles %}

<script>
	function show_quote(c){
		
		var temp = []

		quote = document.getElementById(c);
		for (var i=0; i<quote.childNodes.length; i++) {
			if (quote.childNodes[i].className == 'section comment-quote') {
				temp.push(quote.childNodes[i].innerHTML);
				quote.childNodes[i].innerHTML = '\r\n';
			}
		}
		quote_author = document.getElementById('author'+quote.id).innerHTML;

		inp = document.getElementById('ihatejs');
		inp.value = '[['+quote_author+'('+quote.id+'): '+quote.textContent+']]';
		inp.select();
		document.execCommand('copy');

		ta = document.getElementById('id_comment');
		if (ta.value == ''){
			ta.value = '[['+quote_author+'('+quote.id+'): '+quote.textContent+']]'
		}
		else {
			ta.value = ta.value+'\n[['+quote_author+'('+quote.id+'): '+quote.textContent+']]'
		}

		for (var i=0; i<quote.childNodes.length; i++) {
			if (quote.childNodes[i].className == 'section comment-quote') {
				quote.childNodes[i].innerHTML = temp[i];
			}
		}

		document.getElementById('id_comment').focus();
	}
</script>

<div class="row">
<div class="col-md-12 col-centered text-center">
{% if is_paginated %}
        <ul class="pagination">
            {% if page_obj.has_previous %}
                <li><a href="?page=1"><<</a></li>
                <li><a href="?page={{ page_obj.previous_page_number }}"><</a></li>
            {% endif %}

            {% for i in paginator.page_range %}
                <li {% if page_obj.number == i %} class="active" {% endif %}><a href="?page={{i}}">{{i}}</a></li>
            {% endfor %}

            {% if page_obj.has_next %}
                <li><a href="?page={{ page_obj.next_page_number }}">></a></li>
                <li><a href="?page={{ page_obj.paginator.num_pages }}">>></a></li>
            {% endif %}
        </ul>
    {% endif %}
</div>
</div>

{% for comment in comments %}
<div class="row comment">
    <div class="col-md-2 text-right">
        <a href="{% url 'mafiaapp:profile' user=comment.author.user.nickname %}">
        <h3 id='author{{comment.id}}' style="font-weight:600">{{ comment.author.user.nickname }}</h3><br>
        <img src="{{ comment.author.user.avatar.url }}" style="max-height:120px;max-width:100%;float:right" />
        </a>
        <span>Сообщений: {{ comment.author.comments_number }}</span>
    </div>

    <div class="col-md-8 col-centered comment-text">
        <h3>{# placeholder to match height with nickname on the left #}</h3><span>{{ comment.date|date:"Y-m-d H:i" }}</span>
        <span style="float:right">Сообщение #{{ forloop.counter }}</span>
        <pre id="{{comment.id}}" >{{ comment.text|safe }}</pre>
        <img src="{% static 'mafiaapp/Thumb-up.svg' %}" style="max-height:30px;cursor:pointer;"> {% if comment.like > 0 %}{{ comment.like }}{% endif %}
        {% if user.user.nickname in game.anchor %}
        <span>
        <form action="{% url 'mafiaapp:delete_game_comment' game_slug=game.slug post_slug=post.slug pk=comment.id %}" method="post" class="inline">
            {% csrf_token %}
            <input type="submit" value="Удалить" class="btn btn-primary" >
        </form>
        </span>
      {% endif %}
      <span style='float:right;text-decoration:underline;cursor:pointer;' onClick='show_quote({{comment.id}});'><h4>Цитировать</h4></span>
    </div>
</div>
{% endfor %}

<div style="height:1px;overflow:hidden"><input id='ihatejs' value='' style="margin-top:2px;"></div>

<div class="row">
<div class="col-md-12 col-centered text-center">
{% if is_paginated %}
        <ul class="pagination">
            {% if page_obj.has_previous %}
                <li><a href="?page=1"><<</a></li>
                <li><a href="?page={{ page_obj.previous_page_number }}"><</a></li>
            {% endif %}

            {% for i in paginator.page_range %}
                <li {% if page_obj.number == i %} class="active" {% endif %}><a href="?page={{i}}">{{i}}</a></li>
            {% endfor %}

            {% if page_obj.has_next %}
                <li><a href="?page={{ page_obj.next_page_number }}">></a></li>
                <li><a href="?page={{ page_obj.paginator.num_pages }}">>></a></li>
            {% endif %}
        </ul>
    {% endif %}
</div>
</div>