{% load staticfiles %}

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>{% block title %}Галамафия 2.0{% endblock %}</title>
	<link rel="icon" href="{% static 'mafiaapp/img/favicon.ico' %}">
	<!--
	<link 	rel="stylesheet"	  href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto|Forum">
	<link   rel="stylesheet"	  href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
	
	<link   rel="stylesheet"	  href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap-theme.min.css">
	

	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.6/marked.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
	-->
<link rel="stylesheet" href="{% static 'mafiaapp/vendor/bootstrap.css' %}">
<link rel="stylesheet" href="{% static 'mafiaapp/vendor/bootstrap-theme.css' %}">
<script type="text/javascript" src="{% static 'mafiaapp/vendor/jquery-3.0.0.min.js' %}"></script>
<script type="text/javascript" src="{% static 'mafiaapp/vendor/marked.js' %}"></script>
<script type="text/javascript" src="{% static 'mafiaapp/vendor/notify.min.js' %}"></script>
<script type="text/javascript" src="{% static 'mafiaapp/vendor/bootstrap.min.js' %}"></script>

	<link rel="stylesheet" href="{% static 'mafiaapp/css/style.css' %}">
</head>

<body>
<!--
nav class="navbar navbar-static-top">
	<div class="container-fluid">
		<div class="navbar-header col-centered">
			<div class="navbar-brand col-centered text-center title-super40-div">
				<a href="/"><span class="title-super40">Галактическая мафия 2.0</span></a>
				{% if user.is_authenticated %}
				<span class="title-super40-user">
					<a href="{% url 'mafiaapp:profile' user=user.user.nickname %}"><h3>{{ user.user.nickname }}</h3></a>   
					<a href="/logout">Logout</a>
					<img src="{{ user.user.avatar.url }}">
				</span>
				{% else %}
				<span style="position:absolute;display:inline-block;right:0;margin-top:20px">
					<a href="#" class="text-btn" data-toggle="modal" data-target="#modal-login"><h3>Логин</h3></a>
					<a href="#" class="text-btn" data-toggle="modal" data-target="#modal-register"><h3>Регистрация</h3></a>
				</span>
				{% endif %}
			</div>
		</div>
	</div>
</nav>
-->
{% block header %}
<header class="header">
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-3 col-xs-3 col-sm-3"></div>

			<div class="col-md-6 col-xs-6 col-sm-6 text-center">
				<a href="/">
					<span class="title-super40 font-forum">Галактическая мафия 2.0</span>
				</a>
			</div>

			<div class="col-md-3 col-xs-3 col-sm-3 text-right">
				{% if user.is_authenticated %}
					<a href="{% url 'mafiaapp:profile' user=user.user.nickname %}"><span class="title-super30 font-forum">{{user.user.nickname}}</span></a>   
					<a href="/logout"><span class="title-super20 font-forum">Logout</span></a>
					<img src="{{ user.user.avatar.url }}">
				{% else %}
					<a href="#" class="text-btn" data-toggle="modal" data-target="#modal-login"><span class="title-super30 font-forum">Логин</span></a>
					<a href="#" class="text-btn" data-toggle="modal" data-target="#modal-register"><span class="title-super30 font-forum">Регистрация</span></a>
				{% endif %}
			</div>
		</div>
	</div>
</header>
{% endblock %}

<div class="container">
	{% block content %}{% endblock %}
</div>

<footer class="footer">
<div class="container">
	© 2016 Ruslan Pozin. <a href="https://github.com/prusya/mafpub" target="new">View on GitHub <!--<img src="https://help.github.com/assets/images/site/invertocat.png">--></a>
</div>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-82393292-1', 'auto');
  ga('send', 'pageview');

  function Register() {
  	$("#modal-register-alert-danger").attr('hidden', '');
  	$("#modal-register-alert-danger strong").text('');
  	$("#modal-register-alert-info").attr('hidden', '');
  	$("#modal-register-alert-info strong").text('');
  	$.ajax({
  		method: 'POST',
  		url: '{% url "mafiaapp:ajax_register"%}',
  		data: {
  			email: $('#register-email').val(),
  			csrfmiddlewaretoken: $('input[name="csrfmiddlewaretoken"').val(),
  		}
  	}).done(function(data) {
  		if (data['status'] === 'FAIL') {
  			$("#modal-register-alert-danger").removeAttr('hidden');
  			$("#modal-register-alert-danger strong").text(data['message']);
  		}
  		if (data['status'] === 'OK') {
  			$("#modal-register-alert-info").removeAttr('hidden');
  			$("#modal-register-alert-info strong").text(data['message']);
  		}
  	}).fail(function(data) {
  		if (data['status'] === 'FAIL') {
  			$("#modal-register-alert-danger").removeAttr('hidden');
  			$("#modal-register-alert-danger strong").text(data['message']);
  		}
  		if (data['status'] === 'OK') {
  			$("#modal-register-alert-info").removeAttr('hidden');
  			$("#modal-register-alert-info strong").text(data['message']);
  		}
  	})
  }

  function Login() {
  	$("#modal-login-alert-danger").attr('hidden', '');
  	$("#modal-login-alert-danger strong").text('');
  	$("#modal-login-alert-info").attr('hidden', '');
  	$("#modal-login-alert-info strong").text('');
  	$.ajax({
  		method: 'POST',
  		url: '{% url "mafiaapp:ajax_login"%}'+'/?next='+document.location,
  		data: {
  			email: $('#login-email').val(),
  			password: $('#login-password').val(),
  			csrfmiddlewaretoken: $('input[name="csrfmiddlewaretoken"').val(),
  		}
  	}).done(function(data) {
  		if (data['status'] === 'FAIL') {
  			$("#modal-login-alert-danger").removeAttr('hidden');
  			$("#modal-login-alert-danger strong").text(data['message']);
  		}
  		if (data['status'] === 'OK') {
  			$("#modal-login-alert-info").removeAttr('hidden');
  			$("#modal-login-alert-info strong").text(data['message']);
  			location.href = data['next']
  		}
  	}).fail(function(data) {
  		if (data['status'] === 'FAIL') {
  			$("#modal-login-alert-danger").removeAttr('hidden');
  			$("#modal-login-alert-danger strong").text(data['message']);
  		}
  		if (data['status'] === 'OK') {
  			$("#modal-login-alert-info").removeAttr('hidden');
  			$("#modal-login-alert-info strong").text(data['message']);
  		}
  	})
  }
</script>

<div class="modal fade" id="modal-login" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					<h3 style="font-weight:600;">x</h3>
				</button>
				<h4 class="modal-title" id="myModalLabel">
					<h3>Логин</h3>
				</h4>
			</div>
			<div class="modal-body">
				<div class="col-md-6 col-centered">
					<div class="alert alert-danger" id="modal-login-alert-danger" hidden="">
    					<strong></strong>
					</div>
					<div class="alert alert-info" id="modal-login-alert-info" hidden="">
    					<strong></strong>
					</div>
					<form action="" method="post" class="form-signin">
						{% csrf_token %}
						<input type="email" name="email" placeholder="Email address" class="form-control" id="login-email" />
						<input type="password" name="password" placeholder="Password" class="form-control" id="login-password" />
						<!--
						<div class="col-md-6 col-centered" style="padding:0px">
							<input type="submit" name="submit" value="Логин" class="btn btn-default btn-primary btn-block" />
						</div>
						-->
						<div class="col-md-6 col-centered" style="padding:0px">
							<button type="button" class="btn btn-default btn-primary btn-block" onclick="Login();">
								<h3>Логин</h3>
							</button>
						</div>
					</form>
				</div>
			</div>
			<div class="modal-footer">
			<a href="{% url 'mafiaapp:password_reset' %}" style="text-align: left;" class="text-left">Восстановить пароль</a>
				<button type="button" class="btn btn-default" data-dismiss="modal">
					<h3>Закрыть</h3>
				</button>
			</div>
		</div>	
	</div>			
</div>

<div class="modal fade" id="modal-register" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					<h3 style="font-weight:600;">x</h3>
				</button>
				<h4 class="modal-title" id="myModalLabel">
					<h3>Регистрация</h3>
				</h4>
			</div>
			<div class="modal-body">
				<div class="col-md-6 col-centered">
					<div class="alert alert-danger" id="modal-register-alert-danger" hidden="">
    					<strong></strong>
					</div>
					<div class="alert alert-info" id="modal-register-alert-info" hidden="">
    					<strong></strong>
					</div>
					<form action="{% url 'mafiaapp:index' %}" method="post" class="form-signin">
						{% csrf_token %}
						<input type="email" name="email" placeholder="Email address" class="form-control" id="register-email" />
						<!--
						<div class="col-md-6 col-centered" style="padding:0px">
							<input type="submit" name="submit" value="Регистрация" class="btn btn-default btn-block" />
						</div>
						-->
						<div class="col-md-7 col-centered" style="padding:0px">
							<button type="button" class="btn btn-default btn-primary btn-block" onclick="Register();">
								<h3>Регистрация</h3>
							</button>
						</div>
					</form>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					<h3>Закрыть</h3>
				</button>
			</div>
		</div>	
	</div>			
</div>

{#% debug %#}
</body>

</html>